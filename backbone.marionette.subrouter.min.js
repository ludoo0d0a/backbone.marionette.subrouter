!function(root,factory){"function"==typeof define&&define.amd?define(["underscore","backbone","marionette"],function(_,Backbone,Marionette){return factory(root,_,Backbone,Marionette)}):"undefined"!=typeof exports?module.exports=factory(root,require("underscore"),require("backbone"),require("backbone.marionette")):factory(root,root._,root.Backbone,root.Marionette)}(function(root,_,Backbone,Marionette){return Marionette.SubRouter=Marionette.AppRouter.extend({constructor:function(options){var routes={},prefix=options&&options.prefix||"";this.separator="/"===prefix.slice(-1)?"":"/";var createTrailingSlashRoutes=options&&options.createTrailingSlashRoutes;this.appRoutes&&(options&&options.controller&&(this.controller=options.controller),_.each(this.appRoutes,function(callback,path){path?("/"===path.substr(0)&&(path=path.substr(1,path.length)),routes[prefix+this.separator+path]=callback,createTrailingSlashRoutes&&(routes[prefix+this.separator+path+"/"]=callback)):(routes[prefix]=callback,createTrailingSlashRoutes&&(routes[prefix+"/"]=callback))},this),this.appRoutes=routes),Marionette.AppRouter.prototype.constructor.call(this,options);var hash;hash=Backbone.history.fragment?Backbone.history.getFragment():Backbone.history.getHash(),_.every(this.appRoutes,function(key,route){return!hash.match(Backbone.Router.prototype._routeToRegExp(route))||(Backbone.history.loadUrl(hash),!1)},this)},navigate:function(route,options){"/"!=route.substr(0,1)&&0!==route.indexOf(this.prefix.substr(0,this.prefix.length-1))&&(route=this.prefix+(route?this.separator:"")+route),Marionette.AppRouter.prototype.navigate.call(this,route,options)}}),Marionette.SubRouter});